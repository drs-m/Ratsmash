// libraries
//= require jquery
//= require jquery_ujs
//= require jquery-ui/autocomplete
//= require jquery-ui/effect-shake
//= require modernizr

//= require descriptions
//= require voting
//= require session

mobileMenueIsShown = false;
accountMenueIsShown = false;
news_index = 0;

function closeDdMenues(){
	document.getElementById("acc_link_dd").style.display = "none";
	accountMenueIsShown = false;
	document.getElementById("little_menue").style.display = "none";
	mobileMenueIsShown = false;
}

function manageAccountDd(){
	if(!mobileMenueIsShown){
		document.getElementById("account_link").style.color = "black";
		document.getElementById("acc_link_dd").style.display = "block";
		mobileMenueIsShown = true;
	}
	else{
		document.getElementById("account_link").style.color = "gray";
		document.getElementById("acc_link_dd").style.display = "none";
		mobileMenueIsShown = false;
	}
}

function manageMobileMenue(){
	if(!mobileMenueIsShown){
		document.getElementById("little_menue").style.display = "block";
		mobileMenueIsShown = true;
	}
	else{
		document.getElementById("little_menue").style.display = "none";
		mobileMenueIsShown = false;
	}
}

$(document).ready(function(){

	amount_of_actual_news = $("#amount_of_actual_news").val();
	amount_of_actual_news = parseInt(amount_of_actual_news);

	$("#news_ticker_li_"+news_index).css("display","block");
	$("news_point_0").css("background","black");
	$("#news_point_0").click(function(){
		news_index = 0;
		update_newsticker();
	});
	$("#news_point_1").click(function(){
		news_index = 1;
		update_newsticker();
	});
	$("#news_point_2").click(function(){
		news_index = 2;
		update_newsticker();
	});
	$("#news_point_3").click(function(){
		news_index = 3;
		update_newsticker();
	});
	$("#news_point_4").click(function(){
		news_index = 4;
		update_newsticker();
	});
	$("#left_arrow").click(function(){
		if(news_index==0){
			news_index = amount_of_actual_news - 1;
		}
		else{
			news_index --;
		}
		update_newsticker();
	});
	$("#right_arrow").click(function(){
		if(news_index==amount_of_actual_news - 1){
			news_index = 0;
		}
		else{
			news_index ++;
		}
		update_newsticker();
	});

	if(window.location.pathname == "/vote"){
		$("img").mousemove(function(e){
			$("#icon_info_box").css("display","block");
			$("#icon_info_box").css("top",e.clientY);
			$("#icon_info_box").css("left",e.clientX);
			$("#icon_info_box").html($(this).attr("alt"));
		});
		$("img").mouseout(function(){
			$("#icon_info_box").css("display","none");
		});
	}

	if(window.location.pathname == "/release_state"){
		$.ajax({
			url: "get_mail_status",
			type: "post"
		})
		.done(function(data){
			if(!data[0]){
				$("body").mousemove(function(e){
					var x = e.clientX;
					var y = e.clientY;
					$("#stempel_cursor").css("top",y+1);
					$("#stempel_cursor").css("left",x+1);
					$("body").css("cursor","none");
				});

				$("#send_mail_button").mousemove(function(){
					$("#stempel_schatten").css("display","block");
					$("#stempel_schatten").css("top",parseInt($("#stempel_cursor").css("top")) + 100);
					$("#stempel_schatten").css("left",$("#stempel_cursor").css("left"));
				});
				$("#send_mail_button").mouseout(function(){
					$("#stempel_schatten").css("display","none");
				});
			}
			else{
				$("#send_mail_button").attr("disabled","disabled");
				$("#stempel_cursor").css("display","none");
				$("#stempel_schatten").css("display","none");
				var stempelabdruck = $("#stempelabdruck");
				var offset = parseInt(stempelabdruck.css("height")) / 2;
				stempelabdruck.css("display","block");
				stempelabdruck.css("top",data[2] - offset);
				stempelabdruck.css("left",data[1] - offset);
			}
		});

		$("#send_mail_button").click(function(e){
			var x = e.clientX;
			var y = e.clientY + 100;
			$.ajax({
				url: "/send_mails_to_students",
				type: "POST",
				data: "xpos="+x+"&ypos="+y
			}).done(function(){
				$("#stempel_cursor").animate({
						top: "-=100",
						width: "+=10"
				},1000);
				$("#stempel_cursor").animate({
						top: "+=140",
						width: "-=20"
				},200,function(){
					$("#stempel_schatten").css("display","none");
					$("#stempel_cursor").css("display","none");
					document.getElementById("stamp_sound").volume = 1;
					document.getElementById("stamp_sound").play();
					var aktiv = window.setInterval("checkSoudStatus()", 100);
				});
			});
			return false;
		});
	}
});

function update_newsticker(){
	$("#news_point_0").css("background","gray");
	$("#news_point_1").css("background","gray");
	$("#news_point_2").css("background","gray");
	$("#news_point_3").css("background","gray");
	$("#news_point_4").css("background","gray");
	$("#news_point_"+news_index).css("background","black");

	$("#news_ticker_li_0").hide();
	$("#news_ticker_li_1").hide();
	$("#news_ticker_li_2").hide();
	$("#news_ticker_li_3").hide();
	$("#news_ticker_li_4").hide();
	$("#news_ticker_li_"+news_index).fadeIn(1000);
}

function checkSoudStatus(){
	if(document.getElementById("stamp_sound").ended){
		location.reload();
	}
}